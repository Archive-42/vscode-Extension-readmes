<hr>


<center>


<img src="https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/23b9b236-746e-409c-8e86-30b4385e3b72/hr1-raypham.gif" alt="hr-line" width="781" height="22">


<p>NEXT</p>


</center>


<hr>


<h1 id="magic-python-build-status-apm-package-control-vsm">Magic Python <a href="https://travis-ci.org/MagicStack/MagicPython"><img src="https://travis-ci.org/MagicStack/MagicPython.svg?branch=master" alt="Build Status" /></a> <a href="https://atom.io/packages/magicpython"><img src="https://img.shields.io/apm/dm/magicpython.svg?label=Atom" alt="apm" /></a> <a href="https://packagecontrol.io/packages/MagicPython"><img src="https://img.shields.io/packagecontrol/dt/MagicPython.svg?label=Sublime%20Text" alt="Package Control" /></a> <a href="https://marketplace.visualstudio.com/items?itemName=magicstack.MagicPython"><img src="https://vsmarketplacebadge.apphb.com/installs-short/magicstack.MagicPython.svg?subject=Visual%20Studio%20Code" alt="VSM" /></a></h1>
<p>This is a package with preferences and syntax highlighter for cutting edge Python 3, although Python 2 is well supported, too. The syntax is compatible with <a href="http://www.sublimetext.com">Sublime Text</a>, <a href="http://atom.io">Atom</a> and <a href="http://code.visualstudio.com">Visual Studio Code</a>. It is meant to be a drop-in replacement for the default Python package.</p>
<p>We are proud to say that MagicPython is used by GitHub to highlight Python.</p>
<p><strong>Attention VSCode users</strong>: MagicPython is used as the <em>default</em> Python highlighter in Visual Studio Code. Don't install it unless you want or need the cutting edge version of it. You will likely see no difference because you're already using MagicPython.</p>
<p>MagicPython correctly highlights all Python 3 syntax features, including type annotations, f-strings and regular expressions. It is built from scratch for robustness with an extensive test suite.</p>
<p>Type hints in comments require support by the color scheme. The one used in the screenshot is <a href="https://github.com/MagicStack/Chromodynamics">Chromodynamics</a>.</p>
<p><img src="https://magicstack.github.io/MagicPython/example.png" /></p>
<h2 id="installation-instructions">Installation Instructions</h2>
<p>This is meant to be a drop-in replacement for the default Python package.</p>
<p>In <strong>Atom</strong>, install the <code>MagicPython</code> package and disable the built-in <code>language-python</code> package.</p>
<p>In <strong>Sublime Text</strong>, install <code>MagicPython</code> package via "Package Control" and disable the built-in <code>Python</code> package (using <code>Package Control -&gt; Disable Package</code>, or directly by adding <code>"Python"</code> to <code>"ignored_packages"</code> in the settings file).</p>
<p>In <strong>VSCode</strong>, starting with version 0.10.1, install <code>MagicPython</code> with <code>Install Extension</code> command.</p>
<p>Alternatively, the package can be installed manually in all editors:</p>
<ul>
<li>copy the MagicPython package into the Sublime/Atom/VSCode user packages directory;</li>
<li>disable Python package;</li>
<li>enjoy.</li>
</ul>
<h2 id="changes-and-improvements">Changes and Improvements</h2>
<p>The main motivation behind this package was the difficulty of using modern Python with other common syntax highlighters. They do a good job of the 90% of the language, but then fail on the nuances of some very useful, but often overlooked features. Function annotations tend to freak out the highlighters in various ways. Newly introduced keywords and magic methods are slow to be integrated. Another issue is string highlighting, where all raw strings are often assumed to be regular expressions or special markup used by <code>.format</code> is completely ignored. Bumping into all of these issues on daily basis eventually led to the creation of this package.</p>
<p>Overall, the central idea is that it should be easy to notice something odd or special about the code. Odd or special doesn't necessarily mean incorrect, but certainly worth the explicit attention.</p>
<h3 id="annotations">Annotations</h3>
<p>Annotations should not break the highlighting. They should be no more difficult to read at a glance than other code or comments.</p>
<p>A typical case is having a string annotation that spans several lines by using implicit string concatenation. Multi-line strings are suboptimal for use in annotations as it may be highly undesirable to have odd indentation and extra whitespace in the annotation string. Of course, there is no problem using line continuation or even having comments mixed in with implicit string concatenation. All of these will be highlighted as you'd expect in any other place in the code.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">def</span> some_func(a,                        <span class="co"># nothing fancy here, yet</span></a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3">              b: <span class="st">&#39;Annotation: &#39;</span>         <span class="co"># implicitly</span></a>
<a class="sourceLine" id="cb1-4" title="4">                 <span class="st">&#39;&quot;foo&quot; for Foo, &#39;</span>      <span class="co"># concatenated</span></a>
<a class="sourceLine" id="cb1-5" title="5">                 <span class="st">&#39;&quot;bar&quot; for Bar, &#39;</span>      <span class="co"># annotation</span></a>
<a class="sourceLine" id="cb1-6" title="6">                 <span class="st">&#39;&quot;other&quot; otherwise&#39;</span><span class="op">=</span><span class="st">&#39;otherwise&#39;</span>):</a></code></pre></div>
<p>A more advanced use case for annotations is to actually have complex expressions in them, such as lambda functions, tuples, lists, dicts, sets, comprehensions. Admittedly, all of these might be less frequently used, but when they are, you can rely on them being highlighted normally in all their glorious details.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" title="1"><span class="co"># no reason why this should cause the highlighter to break</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="co">#</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw">def</span> some_func(a:</a>
<a class="sourceLine" id="cb2-4" title="4">                 <span class="co"># annotation starts here</span></a>
<a class="sourceLine" id="cb2-5" title="5">                 <span class="kw">lambda</span> x<span class="op">=</span><span class="va">None</span>:</a>
<a class="sourceLine" id="cb2-6" title="6">                    {key: val</a>
<a class="sourceLine" id="cb2-7" title="7">                        <span class="cf">for</span> key, val <span class="kw">in</span></a>
<a class="sourceLine" id="cb2-8" title="8">                            (x <span class="cf">if</span> x <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> [])</a>
<a class="sourceLine" id="cb2-9" title="9">                    }</a>
<a class="sourceLine" id="cb2-10" title="10">                    <span class="co"># annotation ends here and below is the default for &#39;a&#39;</span></a>
<a class="sourceLine" id="cb2-11" title="11">                    <span class="op">=</span><span class="dv">42</span>):</a></code></pre></div>
<p>Result annotations are handled as any other expression would be. No reason to worry that the body of the function would look messed up.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># no reason why this should cause the highlighter to break</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="co">#</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="kw">def</span> some_func() <span class="op">-&gt;</span> {</a>
<a class="sourceLine" id="cb3-4" title="4">                     <span class="st">&#39;Some&#39;</span>,        <span class="co"># comments</span></a>
<a class="sourceLine" id="cb3-5" title="5">                     <span class="st">&#39;valid&#39;</span>,       <span class="co"># are</span></a>
<a class="sourceLine" id="cb3-6" title="6">                     <span class="st">&#39;expression&#39;</span>   <span class="co"># good</span></a>
<a class="sourceLine" id="cb3-7" title="7">                   }:</a></code></pre></div>
<h3 id="strings">Strings</h3>
<p>Strings are used in many different ways for processing and presenting data. Making the highlighter more friendly towards these uses can help you concentrate your efforts on what matters rather than visual parsing.</p>
<p>Raw strings are often interpreted as regular expressions. This is a bit of a problem, because depending on the application this may actually not be the most common case. Raw strings can simply be the input to some other processor, in which case regexp-specific highlighting is really hindering the overall readability. MagicPython follows a convention that a lower-case <code>r</code> prefix means a regexp string, but an upper-case <code>R</code> prefix means just a raw string with no special regexp semantics. This convention holds true for all of the legal combinations of prefixes. As always the syntax is biased towards Python 3, thus it will mark Python-2-only prefixes (i.e. variations of <code>ur</code>) as deprecated.</p>
<p>String formatting is often only supported for ‘%-style formatting', however, the recommended and more readable syntax used by <code>.format</code> is ignored. The benefits of using simple and readable <code>{key}</code> replacement fields are hindered by the fact that in a complex or long string expression it may not be easily apparent what parameters will actually be needed by <code>.format</code>. This is why MagicPython highlights both kinds of string formatting syntax within the appropriate string types (bytes don't have a <code>.format</code> method in Python 3, so they don't get the special highlighting for it, raw and unicode strings do). Additionally, the highlighter also validates that the formatting is following the correct syntax. It can help noticing an error in complex formatting expressions early.</p>
<p>Python 3.6 f-strings are supported in both the raw and regular flavors. The support for them is somewhat more powerful than what can be done in regular strings with <code>.format</code>, because the f-string spec allows to highlight them with less ambiguity.</p>
<h3 id="numeric-literals">Numeric literals</h3>
<p>Most numbers are just regular decimal constants, but any time that octal, binary, hexadecimal or complex numbers are used it's worth noting that they are of a special type. Highlighting of Python 2 ‘L' integers is also supported.</p>
<p>Underscores in numeric literals are also supported (PEP 515, introduced in Python 3.6):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb4-1" title="1"><span class="dv">100</span>_000_000_000         0b_1110_0101        0x_FF_12_A0_99</a></code></pre></div>
<h3 id="python-3.5-features">Python 3.5 features</h3>
<p>New keywords <code>async</code> and <code>await</code> are properly highlighted. Currently, these keywords are new and are not yet reserved, so the Python interpreter will allow using them as variable names. However, <code>async</code> and <code>await</code> are not recommended to be used as variable, class, function or module names. Introduced by <a href="https://www.python.org/dev/peps/pep-0492/">PEP 492</a> in Python 3.5, they will become proper keywords in Python 3.7. It is very important that the highlighter shows their proper status when they are used as function parameter names, as that could otherwise be unnoticed and lead to very messy debugging down the road.</p>
<h3 id="built-ins-and-magic-methods">Built-ins and Magic Methods</h3>
<p>Various built-in types, classes, functions, as well as magic methods are all highlighted. Specifically, they are highlighted when they appear as names in user definitions. Although it is not an error to have classes and functions that mask the built-ins, it is certainly worth drawing attention to, so that masking becomes a deliberate rather than accidental act.</p>
<p>Highlighting built-ins in class inheritance list makes it slightly more obvious where standard classes are extended. It is also easier to notice some typos (have you ever typed <code>Excepiton</code>?) a little earlier.</p>
<h3 id="parameters-and-arguments">Parameters and Arguments</h3>
<p>MagicPython highlights keywords when they are used as parameter/argument names. This was mentioned for the case of <code>async</code> and <code>await</code>, but it holds true for all other keywords. Although the Python interpreter will produce an appropriate error message when reserved keywords are used as identifier names, it's still worth showing them early, to spare even this small debugging effort.</p>
<h2 id="development">Development</h2>
<p>You need <code>npm</code> and <code>node.js</code> to work on MagicPython.</p>
<ul>
<li>clone the repository</li>
<li>run <code>make</code> to build the local development environment</li>
<li>run <code>make release</code> to build the syntax packages for Sublime Text and Atom (running <code>make test</code> also generates the "release" packages)</li>
</ul>
<p>Please note that we have some unit tests for the syntax scoping. We will be expanding and updating our test corpus. This allows us to trust that tiny inconsistencies will not easily creep in as we update the syntax and fix bugs. Use <code>make test</code> to run the tests regularly while updating the syntax spec. Currently the test files have two parts to them, separated by 3 empty newlines: the code to be scoped and the spec that the result must match.</p>
<p>If you intend to submit a pull request, please follow the following guidelines:</p>
<ul>
<li>keep code lines under 80 characters in length, it improves readability</li>
<li><p>please <em>do</em> use multi-line regular expressions for any non-trivial cases like:</p>
<ul>
<li>the regexp contains a mix of escaped and unescaped braces/parentheses</li>
<li>the regexp has several <code>|</code> in it</li>
<li>the regexp has several pairs of parentheses, especially nested ones</li>
<li>or the regexp is simply longer than 35 characters</li>
</ul></li>
<li>always run <code>make test</code> to ensure that your changes didn't have unexpected side effects</li>
<li><p>update unit tests and add new ones if needed, keeping the test cases short whenever possible</p></li>
</ul>
<h3 id="multiple-scopes">Multiple scopes</h3>
<p>It is sometimes necessary to assign multiple scopes to the same matched group. It is <em>very important</em> to keep in mind that the order of these scopes is apparently treated as significant by the engines processing the grammar specs. However, it is equally important to know that different specification formats seem to have different order of importance (most important first vs. last). Since we try to create grammar that can be compiled into several different formats, we must chose one convention and then translate it when necessary during compilation step. Our convention is therefore that <em>most important scope goes first</em>.</p>
<h2 id="color-scheme">Color Scheme</h2>
<p>If you want to write your own color scheme for MagicPython you can find a list of all the scopes that we use in <a href="https://github.com/MagicStack/MagicPython/blob/master/misc/scopes">misc/scopes</a>. The file is automatically generated based on the syntax grammar, so it is always up-to-date and exhaustive.</p>
