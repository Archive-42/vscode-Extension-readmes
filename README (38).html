<p><img src="https://github.com/redhat-developer/vscode-yaml/workflows/CI/badge.svg" alt="CI" /> <a href="https://travis-ci.org/redhat-developer/vscode-yaml"><img src="https://travis-ci.org/redhat-developer/yaml-language-server.svg?branch=master" alt="Build Status" /></a> <a href="https://marketplace.visualstudio.com/items?itemName=redhat.vscode-yaml"><img src="https://vsmarketplacebadge.apphb.com/version/redhat.vscode-yaml.svg" title="Current Release" alt="Marketplace Version" /></a></p>
<h1 id="yaml-language-support-by-red-hat">YAML Language Support by Red Hat</h1>
<p>Provides comprehensive YAML Language support to <a href="https://code.visualstudio.com/">Visual Studio Code</a>, via the <a href="https://github.com/redhat-developer/yaml-language-server">yaml-language-server</a>, with built-in Kubernetes syntax support.</p>
<p>Supports JSON Schema 7 and below.</p>
<h2 id="features">Features</h2>
<figure>
<img src="https://raw.githubusercontent.com/redhat-developer/vscode-yaml/master/images/demo.gif" alt="screencast" /><figcaption>screencast</figcaption>
</figure>
<ol type="1">
<li>YAML validation:
<ul>
<li>Detects whether the entire file is valid yaml</li>
<li>Detects errors such as:
<ul>
<li>Node is not found</li>
<li>Node has an invalid key node type</li>
<li>Node has an invalid type</li>
<li>Node is not a valid child node</li>
</ul></li>
</ul></li>
<li>Document Outlining (<kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>O</kbd>):
<ul>
<li>Provides the document outlining of all completed nodes in the file</li>
</ul></li>
<li>Auto completion (<kbd>Ctrl</kbd> + <kbd>Space</kbd>):
<ul>
<li>Auto completes on all commands</li>
<li>Scalar nodes autocomplete to schema's defaults if they exist</li>
</ul></li>
<li>Hover support:
<ul>
<li>Hovering over a node shows description <em>if provided by schema</em></li>
</ul></li>
<li>Formatter:
<ul>
<li>Allows for formatting the current file</li>
</ul></li>
</ol>
<p><em>Auto completion and hover support are provided by the schema. Please refer to Language Server Settings to setup a schema</em></p>
<h1 id="language-server-settings">Language Server Settings</h1>
<p>The following settings are supported:</p>
<ul>
<li><code>yaml.format.enable</code>: Enable/disable default YAML formatter (requires restart)</li>
<li><code>yaml.format.singleQuote</code>: Use single quotes instead of double quotes</li>
<li><code>yaml.format.bracketSpacing</code>: Print spaces between brackets in objects</li>
<li><code>yaml.format.proseWrap</code>: Always: wrap prose if it exeeds the print width, Never: never wrap the prose, Preserve: wrap prose as-is</li>
<li><code>yaml.format.printWidth</code>: Specify the line length that the printer will wrap on</li>
<li><code>yaml.validate</code>: Enable/disable validation feature</li>
<li><code>yaml.hover</code>: Enable/disable hover</li>
<li><code>yaml.completion</code>: Enable/disable autocompletion</li>
<li><code>yaml.schemas</code>: Helps you associate schemas with files in a glob pattern</li>
<li><code>yaml.schemaStore.enable</code>: When set to true the YAML language server will pull in all available schemas from <a href="http://schemastore.org/json/">JSON Schema Store</a></li>
<li><code>yaml.customTags</code>: Array of custom tags that the parser will validate against. It has two ways to be used. Either an item in the array is a custom tag such as "!Ref" and it will automatically map !Ref to scalar or you can specify the type of the object !Ref should be e.g. "!Ref sequence". The type of object can be either scalar (for strings and booleans), sequence (for arrays), mapping (for objects).</li>
<li><code>[yaml]</code>: VSCode-YAML adds default configuration for all yaml files. More specifically it converts tabs to spaces to ensure valid yaml, sets the tab size, and allows live typing autocompletion. These settings can be modified via the corresponding settings inside the <code>[yaml]</code> section in the settings:
<ul>
<li><code>editor.insertSpaces</code></li>
<li><code>editor.tabSize</code></li>
<li><code>editor.quickSuggestions</code></li>
</ul></li>
</ul>
<h5 id="adding-custom-tags">Adding custom tags</h5>
<p>In order to use the custom tags in your YAML file you need to first specify the custom tags in the setting of your code editor. For example, you can have the following custom tags:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode yaml"><code class="sourceCode yaml"><a class="sourceLine" id="cb1-1" title="1"><span class="fu">&quot;yaml.customTags&quot;:</span><span class="at"> </span><span class="kw">[</span></a>
<a class="sourceLine" id="cb1-2" title="2">    <span class="st">&quot;!Scalar-example scalar&quot;</span><span class="kw">,</span></a>
<a class="sourceLine" id="cb1-3" title="3">    <span class="st">&quot;!Seq-example sequence&quot;</span><span class="kw">,</span></a>
<a class="sourceLine" id="cb1-4" title="4">    <span class="st">&quot;!Mapping-example mapping&quot;</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="kw">]</span></a></code></pre></div>
<p>The !Scalar-example would map to a scalar custom tag, the !Seq-example would map to a sequence custom tag, the !Mapping-example would map to a mapping custom tag.</p>
<p>You can then use the newly defined custom tags inside the YAML file:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode yaml"><code class="sourceCode yaml"><a class="sourceLine" id="cb2-1" title="1"><span class="fu">some_key:</span><span class="at"> !Scalar-example some_value</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="fu">some_sequence:</span><span class="at"> !Seq-example</span></a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="kw">-</span> <span class="fu">some_seq_key_1:</span><span class="at"> some_seq_value_1</span></a>
<a class="sourceLine" id="cb2-4" title="4">  <span class="kw">-</span> <span class="fu">some_seq_key_2:</span><span class="at"> some_seq_value_2</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="fu">some_mapping:</span><span class="at"> !Mapping-example</span></a>
<a class="sourceLine" id="cb2-6" title="6">  <span class="fu">some_mapping_key_1:</span><span class="at"> some_mapping_value_1</span></a>
<a class="sourceLine" id="cb2-7" title="7">  <span class="fu">some_mapping_key_2:</span><span class="at"> some_mapping_value_2</span></a></code></pre></div>
<h5 id="associating-a-schema-to-a-glob-pattern-via-yaml.schemas">Associating a schema to a glob pattern via yaml.schemas:</h5>
<p>yaml.schemas applies a schema to a file. In other words, the schema (placed on the left) is applied to the glob pattern on the right. Your schema can be local or online. Your schema must be a relative path and not an absolute path.</p>
<p>When associating a schema it should follow the format below</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb3-1" title="1"><span class="er">&quot;yaml.schemas&quot;:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb3-2" title="2">    <span class="dt">&quot;url&quot;</span><span class="fu">:</span> <span class="st">&quot;globPattern&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb3-3" title="3">    <span class="dt">&quot;Kubernetes&quot;</span><span class="fu">:</span> <span class="st">&quot;globPattern&quot;</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="fu">}</span></a></code></pre></div>
<p>e.g.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb4-1" title="1"><span class="er">&quot;yaml.schemas&quot;:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb4-2" title="2">    <span class="dt">&quot;http://json.schemastore.org/composer&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;/*&quot;</span><span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-3" title="3">    <span class="dt">&quot;file:///home/johnd/some-schema.json&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;some.yaml&quot;</span><span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-4" title="4">    <span class="dt">&quot;../relative/path/schema.json&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;/config*.yaml&quot;</span><span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-5" title="5">    <span class="dt">&quot;/Users/johnd/some-schema.json&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;some.yaml&quot;</span><span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="fu">}</span></a></code></pre></div>
<p>e.g.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb5-1" title="1"><span class="er">&quot;yaml.schemas&quot;:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb5-2" title="2">    <span class="dt">&quot;kubernetes&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;/myYamlFile.yaml&quot;</span><span class="ot">]</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="fu">}</span></a></code></pre></div>
<p>e.g.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb6-1" title="1"><span class="er">&quot;yaml.schemas&quot;:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb6-2" title="2">    <span class="dt">&quot;http://json.schemastore.org/composer&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;/*&quot;</span><span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb6-3" title="3">    <span class="dt">&quot;kubernetes&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;/myYamlFile.yaml&quot;</span><span class="ot">]</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="fu">}</span></a></code></pre></div>
<p>Since <code>0.11.0</code> YAML Schemas can be used for validation:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb7-1" title="1"> <span class="er">&quot;/home/user/custom_schema.yaml&quot;:</span> <span class="er">&quot;someFilePattern.yaml&quot;</span></a></code></pre></div>
<ul>
<li>The entrance point for <code>yaml.schemas</code> is location in <a href="https://code.visualstudio.com/docs/getstarted/settings#_creating-user-and-workspace-settings">user and workspace settings</a></li>
<li>Supports schemas through <a href="http://schemastore.org/json/">schema store</a> as well as any other schema url</li>
<li>Supports ‘yamlValidation' point which allows you to contribute a schema for a specific type of yaml file (Similar to <a href="https://code.visualstudio.com/docs/extensionAPI/extension-points#_contributesjsonvalidation">jsonValidation</a>) e.g.</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb8-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb8-2" title="2">  <span class="dt">&quot;contributes&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb8-3" title="3">    <span class="dt">&quot;yamlValidation&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb8-4" title="4">      <span class="fu">{</span></a>
<a class="sourceLine" id="cb8-5" title="5">        <span class="dt">&quot;fileMatch&quot;</span><span class="fu">:</span> <span class="st">&quot;yourfile.yml&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-6" title="6">        <span class="dt">&quot;url&quot;</span><span class="fu">:</span> <span class="st">&quot;./schema.json&quot;</span></a>
<a class="sourceLine" id="cb8-7" title="7">      <span class="fu">}</span></a>
<a class="sourceLine" id="cb8-8" title="8">    <span class="ot">]</span></a>
<a class="sourceLine" id="cb8-9" title="9">  <span class="fu">}</span></a>
<a class="sourceLine" id="cb8-10" title="10"><span class="fu">}</span></a></code></pre></div>
<p>This extension allows you to specify json schemas that you want to validate against the yaml that you write. In the vscode user and workspace preferences you can set a url and a glob pattern that you want to validate against the schema. Kubernetes is an optional field. They do not require a url as the language server will provide that. You just need the keyword kubernetes and a glob pattern.</p>
<h2 id="developer-support">Developer Support</h2>
<h3 id="getting-started">Getting started</h3>
<ol type="1">
<li>Install prerequisites:
<ul>
<li>latest <a href="https://code.visualstudio.com/">Visual Studio Code</a></li>
<li><a href="https://nodejs.org/">Node.js</a> v6.0.0 or higher</li>
</ul></li>
<li><p>Fork and clone this repository and go into the folder</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb9-1" title="1"> $ <span class="bu">cd</span> vscode-yaml</a></code></pre></div></li>
<li><p>Install the dependencies</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb10-1" title="1">$ <span class="ex">npm</span> install</a></code></pre></div></li>
<li><p>Compile the Typescript to Javascript</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb11-1" title="1">$ <span class="ex">npm</span> run compile</a></code></pre></div></li>
</ol>
<h4 id="developing-the-client-side">Developing the client side</h4>
<ol type="1">
<li>Open the client in vscode</li>
<li>Make changes as neccessary and the run the code using F5</li>
</ol>
<h4 id="developing-the-client-and-server-together">Developing the client and server together</h4>
<ol type="1">
<li><p>Download both the <a href="https://github.com/redhat-developer/yaml-language-server">Yaml Language Server</a> and this VSCode Yaml Client.</p></li>
<li><p>Create a project with the directories in the following structure.</p></li>
</ol>
<pre><code>ParentFolder/
          ├──── vscode-yaml/
          ├──── yaml-language-server/</code></pre>
<ol start="3" type="1">
<li>Run <code>npm install</code> in both directories to initialize <code>node_modules</code> dependencies.</li>
<li><p>In <code>vscode-yaml/src/extension.ts</code> set the <code>serverModule</code> variable to:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode ts"><code class="sourceCode typescript"><a class="sourceLine" id="cb13-1" title="1">serverModule <span class="op">=</span> <span class="va">context</span><span class="op">.</span><span class="fu">asAbsolutePath</span>(<span class="va">path</span><span class="op">.</span><span class="fu">join</span>(<span class="st">&#39;..&#39;</span><span class="op">,</span> <span class="st">&#39;yaml-language-server&#39;</span><span class="op">,</span> <span class="st">&#39;out&#39;</span><span class="op">,</span> <span class="st">&#39;server&#39;</span><span class="op">,</span> <span class="st">&#39;src&#39;</span><span class="op">,</span> <span class="st">&#39;server.js&#39;</span>))<span class="op">;</span></a></code></pre></div>
<p><em>This will redirect which YAML LS to use.</em></p></li>
<li><p>In BOTH directories run:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb14-1" title="1"><span class="ex">npm</span> run compile</a></code></pre></div></li>
<li><p>To run the language server in VSCode, click <code>View -&gt; Debug</code>, then from the drop down menu beside the green arrow select <code>Launch Extension (vscode-yaml)</code>, click the arrow, and a new VSCode window should load with the YAML LS running.</p></li>
<li><p>To debug the language server in VSCode, from the same drop down menu select <code>Attach (yaml-language-server)</code>, and click the green arrow to start. Ensure you've opened a YAML file or else the server would have not yet started.</p></li>
</ol>
<p><strong>Note:</strong> Disable or remove any existing implementations of the YAML Language server from VSCode or there will be conflicts.</p>
<h5 id="developing-the-server-side">Developing the server side</h5>
<ol type="1">
<li>To develop the language server visit https://github.com/redhat-developer/yaml-language-server</li>
</ol>
<p>Refer to VS Code <a href="https://code.visualstudio.com/docs/extensions/debugging-extensions">documentation</a> on how to run and debug the extension</p>
<h3 id="installation-from-github-release">Installation from Github Release</h3>
<p>To obtain and install the latest release from github you can:</p>
<ul>
<li>First download the latest *.vsix file from <a href="https://github.com/redhat-developer/vscode-yaml/releases">Github Releases section</a></li>
<li>Inside of VSCode navigate to the extension tab and click the three elipses (…).</li>
<li>Click install from VSIX and provide the location of the *.vsix that was downloaded</li>
</ul>
<h3 id="contributing">Contributing</h3>
<p>All contributions are welcome!</p>
